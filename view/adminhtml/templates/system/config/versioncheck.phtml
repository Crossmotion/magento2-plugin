<?php

/**
 * @see \Paynl\Payment\Block\Adminhtml\Render\Version
 * @var \Paynl\Payment\Block\Adminhtml\Render\Version $block
 */
?>
<?= $block->getVersion() ?>
<?= $block->getButtonHtml() ?>
<tr id="version" class="paynl_version_check_row" style="display: none;">
    <td class="label"></td>
    <td class="value">
        <span id="paynl_version_check_loading" style="display: none;">Loading...</span>
        <span id="paynl_version_check_result" style="display: none;"></span>
    </td>
</tr>
<script>
    require([
        'jquery'
    ], function (jQuery) {
        jQuery('#version').click(function () {
            new Ajax.Request('<?= $block->getAjaxUrl() ?>', {
                loaderArea: false,
                asynchronous: true,
                onCreate: function () {
                    jQuery('#paynl_version_check_result').hide();
                    jQuery('.paynl_version_check_row').show();
                    jQuery('#paynl_version_check_loading').show();
                },
                onSuccess: function (response) {
                    var json = response.responseJSON;

                    var check = json.version.substring(1);
                    var version = "<?= $block->getVersion() ?>";

                    if (check === version){
                        result = check + " - You are up to date with the latest version"
                    }else {
                        result = check + " - There is a new version of the PAY. plugin available"
                    }

                    jQuery('#paynl_version_check_result').html(result);
                    jQuery('#paynl_version_check_result').show();
                    jQuery('#paynl_version_check_loading').hide();
                }
            });
        });
    });
</script>