<?php

/**
 * @see \Paynl\Payment\Block\Adminhtml\Render\Version
 * @var \Paynl\Payment\Block\Adminhtml\Render\Version $block
 */
?>
<?= $block->getVersion() ?>
<?= $block->getButtonHtml() ?>
<span id="version" class="paynl_version_check_row" style="display: none; margin-bottom:5px; padding-top:15px;">
    <span id="paynl_version_check_loading" style="display: none;">Loading...</span>
    <span id="paynl_version_check_result" style="display: none;"></span>
</span>

<script>
    require([
        'jquery'
    ], function(jQuery) {
        jQuery('#version').click(function() {
            new Ajax.Request('<?= $block->getAjaxUrl() ?>', {
                loaderArea: false,
                asynchronous: true,
                onCreate: function() {
                    jQuery('#paynl_version_check_result').hide();
                    jQuery('.paynl_version_check_row').css('display', 'block');
                    jQuery('#paynl_version_check_loading').css('display', 'block');
                },
                onSuccess: function(response) {
                    var json = response.responseJSON;

                    var check = json.version.substring(1);
                    var version = "<?= $block->getVersion() ?>";

                    if (check === version) {
                        result = "You are up to date with the latest version"
                        jQuery('#paynl_version_check_result').css({
                            "color": "#10723a",
                            "font-weight": "bold"
                        });
                    } else {
                        result = "There is a new version of the Pay. plugin available (" + json.version + ")"
                    }

                    jQuery('#paynl_version_check_result').html(result);
                    jQuery('#paynl_version_check_result').css('display', 'block');
                    jQuery('#paynl_version_check_loading').hide();
                }
            });
        });
    });
</script>